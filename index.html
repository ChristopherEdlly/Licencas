<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard SUTRI - Sistema de Licenças</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css" rel="stylesheet">
    <link href="css/new-styles.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/themeManager.js"></script>
</head>
<body>
    <!-- Layout Principal -->
    <div class="app-layout">
        <!-- Sidebar -->
        <aside class="sidebar">
            <!-- Header da Sidebar -->
            <div class="sidebar-header">
                <div class="brand">
                    <i class="bi bi-graph-up-arrow"></i>
                    <span class="brand-text">SUTRI</span>
                </div>
                <button class="sidebar-toggle" id="sidebarToggle" title="Recolher sidebar">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>

            <!-- Navegação -->
            <nav class="sidebar-nav">
                <a href="#" class="nav-link active" data-page="home" data-tooltip="Visão Geral">
                    <i class="bi bi-house"></i>
                    <span>Visão Geral</span>
                </a>
                <a href="#" class="nav-link" data-page="calendar" data-tooltip="Calendário">
                    <i class="bi bi-calendar3"></i>
                    <span>Calendário</span>
                </a>
                <a href="#" class="nav-link" data-page="timeline" data-tooltip="Timeline">
                    <i class="bi bi-clock-history"></i>
                    <span>Timeline</span>
                </a>
            </nav>

            <!-- Filtros Compactos -->
            <div class="sidebar-filters">
                <div class="filter-section">
                    <label class="filter-label">Buscar</label>
                    <div class="search-box">
                        <i class="bi bi-search"></i>
                        <input type="text" id="searchInput" placeholder="Nome, cargo...">
                        <button class="btn-clear" id="clearSearchBtn" style="display: none;">
                            <i class="bi bi-x"></i>
                        </button>
                    </div>
                </div>

                <!-- Filtro de Idade (para cronograma) -->
                <div class="filter-section" id="ageFilterSection">
                    <label class="filter-label">Idade</label>
                    <div class="age-filter">
                        <input type="number" id="minAge" value="18" min="18" max="100">
                        <span>-</span>
                        <input type="number" id="maxAge" value="70" min="18" max="100">
                    </div>
                    <div class="age-presets">
                        <button class="preset-btn" onclick="window.dashboard && dashboard.setAgePreset(18, 35)">18-35</button>
                        <button class="preset-btn" onclick="window.dashboard && dashboard.setAgePreset(36, 50)">36-50</button>
                        <button class="preset-btn" onclick="window.dashboard && dashboard.setAgePreset(51, 70)">51+</button>
                    </div>
                </div>

                <!-- Filtro de Período/Mês (para licenças prêmio) -->
                <div class="filter-section" id="periodFilterSection" style="display: none;">
                    <label class="filter-label">Período de Licença</label>
                    <div class="period-filter">
                        <select id="mesFilter">
                            <option value="">Todos os meses</option>
                            <option value="janeiro">Janeiro</option>
                            <option value="fevereiro">Fevereiro</option>
                            <option value="março">Março</option>
                            <option value="abril">Abril</option>
                            <option value="maio">Maio</option>
                            <option value="junho">Junho</option>
                            <option value="julho">Julho</option>
                            <option value="agosto">Agosto</option>
                            <option value="setembro">Setembro</option>
                            <option value="outubro">Outubro</option>
                            <option value="novembro">Novembro</option>
                            <option value="dezembro">Dezembro</option>
                        </select>
                    </div>
                </div>

                <div class="filter-actions">
                                        <button class="btn-primary" onclick="window.dashboard && dashboard.applyAgeFilter()">
                        <i class="bi bi-check"></i>
                        Aplicar
                    </button>
                    <button class="btn-secondary" onclick="window.dashboard && dashboard.clearAllFilters()">
                        <i class="bi bi-x-circle"></i>
                        Limpar Filtros
                    </button>
                </div>
            </div>
        </aside>

        <!-- Área Principal -->
        <main class="main-content">
            <!-- Header Compacto -->
            <header class="main-header">
                <div class="header-info">
                    <h1 class="page-title" id="pageTitle">Visão Geral</h1>
                    <div class="stats-compact">
                        <div class="stat-item">
                            <span class="stat-value" id="totalServidores">0</span>
                            <span class="stat-label">Servidores</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-value" id="totalLicencasFuturas">0</span>
                            <span class="stat-label">Licenças Futuras</span>
                        </div>
                        <div class="stat-item">
                            <span class="last-update" id="lastUpdate">--:--</span>
                        </div>
                    </div>
                </div>
                
                <!-- Actions do Header -->
                <div class="header-actions">
                    <input type="file" id="fileInput" accept=".csv,.xlsx,.xls" hidden>
                    <label for="fileInput" class="btn-upload-header" title="Carregar Dados">
                        <i class="bi bi-cloud-upload"></i>
                    </label>
                    <button class="theme-toggle" id="themeToggle" title="Alternar tema">
                        <i class="bi bi-sun theme-icon sun-icon"></i>
                        <i class="bi bi-moon theme-icon moon-icon"></i>
                    </button>
                </div>
            </header>

            <!-- Conteúdo das Páginas -->
            <div class="content-area">
                <!-- Home Page -->
                <div class="page-content active" id="homePage">
                    <!-- Cards de Estatísticas - Linha Superior -->
                    <div class="stats-cards">
                        <div class="stat-card critical">
                            <div class="card-icon">
                                <i class="bi bi-exclamation-triangle"></i>
                            </div>
                            <div class="card-content">
                                <h3 id="criticalCount">0</h3>
                                <p>Urgência Crítica</p>
                            </div>
                        </div>
                        <div class="stat-card high">
                            <div class="card-icon">
                                <i class="bi bi-clock"></i>
                            </div>
                            <div class="card-content">
                                <h3 id="highCount">0</h3>
                                <p>Urgência Alta</p>
                            </div>
                        </div>
                        <div class="stat-card moderate">
                            <div class="card-icon">
                                <i class="bi bi-calendar-check"></i>
                            </div>
                            <div class="card-content">
                                <h3 id="moderateCount">0</h3>
                                <p>Urgência Moderada</p>
                            </div>
                        </div>
                        <div class="stat-card error" id="errorCard" title="Clique para ver detalhes">
                            <div class="card-icon">
                                <i class="bi bi-exclamation-octagon"></i>
                            </div>
                            <div class="card-content">
                                <h3 id="errorCount">0</h3>
                                <p>Problemas</p>
                            </div>
                        </div>
                    </div>

                    <!-- Conteúdo Principal - Gráfico e Tabela -->
                    <div class="content-grid">
                        <!-- Gráfico -->
                        <div class="chart-area">
                            <div class="chart-header">
                                <h3 class="chart-title">Distribuição por Urgência</h3>
                            </div>
                            <div class="chart-container">
                                <canvas id="urgencyChart"></canvas>
                            </div>
                            <div class="chart-legends">
                                <div class="legend-card critical" data-urgency="critical">
                                    <div class="legend-color"></div>
                                    <span class="legend-label">Crítica</span>
                                    <span class="legend-count" id="legendCritical">0</span>
                                </div>
                                <div class="legend-card high" data-urgency="high">
                                    <div class="legend-color"></div>
                                    <span class="legend-label">Alta</span>
                                    <span class="legend-count" id="legendHigh">0</span>
                                </div>
                                <div class="legend-card moderate" data-urgency="moderate">
                                    <div class="legend-color"></div>
                                    <span class="legend-label">Moderada</span>
                                    <span class="legend-count" id="legendModerate">0</span>
                                </div>
                                <div class="legend-card low" data-urgency="low">
                                    <div class="legend-color"></div>
                                    <span class="legend-label">Baixa</span>
                                    <span class="legend-count" id="legendLow">0</span>
                                </div>
                            </div>
                        </div>

                        <!-- Tabela -->
                        <div class="table-area">
                            <div class="table-header">
                                <h3 class="table-title">Servidores</h3>
                                <span class="result-count" id="resultCount">0 resultados</span>
                            </div>
                            <div class="table-container">
                                <table class="data-table" id="servidoresTable">
                                    <thead>
                                        <tr>
                                            <th>Nome</th>
                                            <th>Idade</th>
                                            <th>Lotação</th>
                                            <th>Próxima Licença</th>
                                            <th>Urgência</th>
                                            <th>Ações</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tableBody">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Calendar Page -->
                <div class="page-content" id="calendarPage">
                    <div class="calendar-page-container">
                        <!-- Calendar Header with Year Navigation -->
                        <div class="calendar-header">
                            <div class="year-navigation">
                                <button class="btn-year-nav" id="prevYearBtn">
                                    <i class="bi bi-chevron-left"></i>
                                </button>
                                <div class="current-year">
                                    <span id="currentCalendarYear">2025</span>
                                </div>
                                <button class="btn-year-nav" id="nextYearBtn">
                                    <i class="bi bi-chevron-right"></i>
                                </button>
                            </div>
                            <div class="calendar-legend">
                                <span class="legend-title">Intensidade de licenças:</span>
                                <div class="legend-scale">
                                    <div class="legend-step">
                                        <div class="legend-color level-0">0</div>
                                        <span class="legend-text">Nenhuma</span>
                                    </div>
                                    <div class="legend-step">
                                        <div class="legend-color level-1">1</div>
                                        <span class="legend-text">Baixa</span>
                                    </div>
                                    <div class="legend-step">
                                        <div class="legend-color level-2">2-3</div>
                                        <span class="legend-text">Moderada</span>
                                    </div>
                                    <div class="legend-step">
                                        <div class="legend-color level-3">4-5</div>
                                        <span class="legend-text">Alta</span>
                                    </div>
                                    <div class="legend-step">
                                        <div class="legend-color level-4">6+</div>
                                        <span class="legend-text">Muito Alta</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Calendar Content with Scroll -->
                        <div class="calendar-scroll-container">
                            <div class="calendar-container">
                                <div id="yearlyHeatmap" class="heatmap-container"></div>
                            </div>
                        </div>

                        <!-- Day Details Panel -->
                        <div class="day-details-panel" id="dayDetailsPanel" style="display: none;">
                            <div class="panel-header">
                                <h4 id="selectedDateTitle">Licenças do Dia</h4>
                                <button class="btn-close-panel" id="closePanelBtn">
                                    <i class="bi bi-x"></i>
                                </button>
                            </div>
                            <div class="panel-content">
                                <div class="servers-list" id="selectedDateServers">
                                    <!-- Conteúdo dinâmico -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Timeline Page -->
                <div class="page-content" id="timelinePage">
                    <div class="timeline-header">
                        <h2>Timeline de Licenças</h2>
                        <div class="timeline-controls">
                            <div class="control-group">
                                <label for="timelineView">Visualização:</label>
                                <select id="timelineView" class="form-select">
                                    <option value="daily">Diário</option>
                                    <option value="monthly" selected>Mensal</option>
                                    <option value="yearly">Anual</option>
                                </select>
                            </div>
                            <div class="control-group" id="timelineYearGroup">
                                <label for="timelineYear">Ano:</label>
                                <select id="timelineYear" class="form-select">
                                    <!-- Options will be populated by JavaScript -->
                                </select>
                            </div>
                            <div class="control-group" id="timelineMonthGroup" style="display: none;">
                                <label for="timelineMonth">Mês:</label>
                                <select id="timelineMonth" class="form-select">
                                    <option value="0">Janeiro</option>
                                    <option value="1">Fevereiro</option>
                                    <option value="2">Março</option>
                                    <option value="3">Abril</option>
                                    <option value="4">Maio</option>
                                    <option value="5">Junho</option>
                                    <option value="6">Julho</option>
                                    <option value="7">Agosto</option>
                                    <option value="8">Setembro</option>
                                    <option value="9">Outubro</option>
                                    <option value="10">Novembro</option>
                                    <option value="11">Dezembro</option>
                                </select>
                            </div>
                            <button id="showPeriodStatsBtn" class="btn btn-primary" style="display: none;">
                                <i class="bi bi-bar-chart"></i>
                                Ver Estatísticas do Período
                            </button>
                            <button id="exportTimelineBtn" class="btn btn-secondary">
                                <i class="bi bi-download"></i>
                                Exportar
                            </button>
                        </div>
                    </div>
                    
                    <div class="timeline-content">
                        <div class="timeline-stats">
                            <div class="stat-card timeline-stat">
                                <div class="card-icon">
                                    <i class="bi bi-calendar-event"></i>
                                </div>
                                <div class="card-content">
                                    <h3 id="totalLicensesCount">0</h3>
                                    <p>Total de Licenças</p>
                                </div>
                            </div>
                            <div class="stat-card timeline-stat">
                                <div class="card-icon">
                                    <i class="bi bi-person-check"></i>
                                </div>
                                <div class="card-content">
                                    <h3 id="activeServersCount">0</h3>
                                    <p>Servidores Ativos</p>
                                </div>
                            </div>
                            <div class="stat-card timeline-stat">
                                <div class="card-icon">
                                    <i class="bi bi-graph-up-arrow"></i>
                                </div>
                                <div class="card-content">
                                    <h3 id="peakPeriod">-</h3>
                                    <p>Pico de Licenças</p>
                                </div>
                            </div>
                            <div class="stat-card timeline-stat">
                                <div class="card-icon">
                                    <i class="bi bi-bar-chart"></i>
                                </div>
                                <div class="card-content">
                                    <h3 id="averageLicenses">0</h3>
                                    <p>Média por Período</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="timeline-chart-container">
                            <canvas id="timelineChart"></canvas>
                        </div>
                        
                        <div class="timeline-insights">
                            <div class="insight-card">
                                <h4><i class="bi bi-lightbulb"></i> Insights</h4>
                                <div id="timelineInsights" class="insights-content">
                                    <!-- Dynamic insights will be added here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modal de Timeline -->
    <div class="modal" id="timelineModal">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title-section">
                    <h3 id="timelineModalTitle">Detalhes do Período</h3>
                </div>
                <button class="btn-close" id="timelineModalCloseBtn">
                    <i class="bi bi-x"></i>
                </button>
            </div>
            <div class="modal-body" id="timelineModalBody">
                <div class="modal-sections">
                    <!-- Seção: Servidores em Licença -->
                    <div class="modal-section">
                        <div class="section-header">
                            <i class="bi bi-people section-icon"></i>
                            <h4 class="section-title">Servidores em Licença</h4>
                            <span class="section-badge" id="serversCount">0</span>
                        </div>
                        <div class="section-content" id="timelineServersList">
                            <!-- Lista de servidores -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Estatísticas do Período -->
    <div class="modal" id="periodStatsModal">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title-section">
                    <h3 id="periodStatsModalTitle">Estatísticas do Período</h3>
                </div>
                <button class="btn-close" id="periodStatsModalCloseBtn">
                    <i class="bi bi-x"></i>
                </button>
            </div>
            <div class="modal-body" id="periodStatsModalBody">
                <div class="stats-grid" id="periodStatsGrid">
                    <!-- Estatísticas serão inseridas aqui -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div class="modal" id="detailsModal">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-enhanced">
            <div class="modal-header">
                <div class="modal-title-section">
                    <h3 id="modalTitle">Detalhes do Servidor</h3>
                </div>
                <button class="btn-close" id="modalCloseBtn">
                    <i class="bi bi-x"></i>
                </button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Conteúdo será inserido dinamicamente -->
                <div class="modal-sections">
                    <!-- Seção: Informações Pessoais -->
                    <div class="modal-section" id="personalInfoSection">
                        <div class="section-header">
                            <i class="bi bi-person-circle section-icon"></i>
                            <h4 class="section-title">Informações Pessoais</h4>
                        </div>
                        <div class="section-content" id="personalInfoContent">
                            <!-- Conteúdo dinâmico -->
                        </div>
                    </div>

                    <!-- Seção: Dados Originais -->
                    <div class="modal-section" id="originalDataSection">
                        <div class="section-header">
                            <i class="bi bi-file-text section-icon"></i>
                            <h4 class="section-title">Dados Originais da Planilha</h4>
                            <span class="section-badge">Como fornecido</span>
                        </div>
                        <div class="section-content" id="originalDataContent">
                            <!-- Conteúdo dinâmico -->
                        </div>
                    </div>

                    <!-- Seção: Interpretação do Sistema -->
                    <div class="modal-section" id="interpretationSection">
                        <div class="section-header">
                            <i class="bi bi-cpu section-icon"></i>
                            <h4 class="section-title">Interpretação do Sistema</h4>
                            <span class="section-badge interpretation">Processado</span>
                        </div>
                        <div class="section-content" id="interpretationContent">
                            <!-- Conteúdo dinâmico -->
                        </div>
                    </div>

                    <!-- Seção: Possíveis Problemas -->
                    <div class="modal-section warning-section" id="issuesSection" style="display: none;">
                        <div class="section-header">
                            <i class="bi bi-exclamation-triangle section-icon"></i>
                            <h4 class="section-title">Possíveis Problemas</h4>
                            <span class="section-badge warning">Atenção</span>
                        </div>
                        <div class="section-content" id="issuesContent">
                            <!-- Conteúdo dinâmico -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Problemas -->
    <div class="modal" id="problemsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Servidores com Problemas</h3>
                <button class="btn-close" id="problemsModalCloseBtn">
                    <i class="bi bi-x"></i>
                </button>
            </div>
            <div class="modal-body" id="problemsModalBody">
                <div class="problems-list">
                    <p class="problems-description">
                        <i class="bi bi-info-circle"></i>
                        Lista de servidores que apresentaram problemas durante o carregamento dos dados:
                    </p>
                    <div class="problems-content" id="problemsContent">
                        <!-- Conteúdo será inserido dinamicamente -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <span class="loading-text">Processando dados...</span>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/cronogramaParser.js"></script>
    <script src="js/dashboard.js"></script>
</body>
</html>
